<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script src="https://unpkg.com/lenis@1.0.29/dist/lenis.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  lucide.createIcons();

  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const closeMenu = document.getElementById('close-menu');

  if (menuBtn) menuBtn.addEventListener('click', () => mobileMenu.classList.add('open'));
  if (closeMenu) closeMenu.addEventListener('click', () => mobileMenu.classList.remove('open'));
  if (mobileMenu) mobileMenu.addEventListener('click', (e) => { 
    if (e.target.tagName === 'A') mobileMenu.classList.remove('open'); 
  });

  const tlLoader = gsap.timeline();
  tlLoader.to(".loader-bar", { height: "100%", duration: 0.8, stagger: 0.1, ease: "power4.inOut" })
    .to("#loader h1", { opacity: 0, duration: 0.2 })
    .to("#loader", { y: "-100%", duration: 0.8, ease: "power4.inOut" }, "-=0.2")
    .from(".hero-text", { y: 200, opacity: 0, rotate: 5, stagger: 0.1, duration: 1, ease: "power3.out" }, "-=0.5");

  const lenis = new Lenis({ 
    duration: 1.2, 
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), 
    smooth: true, 
    touchMultiplier: 2 
  });
  
  function raf(time) { 
    lenis.raf(time); 
    requestAnimationFrame(raf); 
  } 
  requestAnimationFrame(raf);

  gsap.registerPlugin(ScrollTrigger);
  gsap.to(".float-anim", { 
    y: -100, 
    scrollTrigger: { 
      trigger: "body", 
      start: "top top", 
      end: "bottom top", 
      scrub: 1 
    } 
  });
  
  gsap.to(".float-anim-reverse", { 
    y: 150, 
    rotate: 45, 
    scrollTrigger: { 
      trigger: "body", 
      start: "top top", 
      end: "bottom top", 
      scrub: 1.5 
    } 
  });

  document.querySelectorAll(".manifesto-text").forEach(text => {
    gsap.to(text, { 
      opacity: 1, 
      scrollTrigger: { 
        trigger: text, 
        start: "top 80%", 
        end: "top 40%", 
        scrub: true 
      } 
    });
  });

  if (window.innerWidth > 768 && window.matchMedia('(pointer: fine)').matches) {
    const cursor = document.getElementById('cursor');
    const links = document.querySelectorAll('a, button, .service-card, summary');
    
    document.addEventListener('mousemove', (e) => {
      cursor.style.left = e.clientX + 'px';
      cursor.style.top = e.clientY + 'px';
    });
    
    links.forEach(link => {
      link.addEventListener('mouseenter', () => {
        cursor.style.width = '60px';
        cursor.style.height = '60px';
        cursor.style.backgroundColor = '#A3FF00';
        cursor.style.mixBlendMode = 'exclusion';
      });
      link.addEventListener('mouseleave', () => {
        cursor.style.width = '24px';
        cursor.style.height = '24px';
        cursor.style.backgroundColor = '#0f0f0f';
        cursor.style.mixBlendMode = 'difference';
      });
    });
  }

  const dangerBtn = document.getElementById('danger-btn');
  if (dangerBtn) {
    dangerBtn.addEventListener('click', () => {
      gsap.to("body", { x: -10, duration: 0.1, yoyo: true, repeat: 5 });
      const duration = 2000;
      const end = Date.now() + duration;
      (function frame() {
        confetti({ 
          particleCount: 5, 
          angle: 60, 
          spread: 55, 
          origin: { x: 0 }, 
          colors: ['#FF4D00', '#A3FF00', '#9D00FF'] 
        });
        confetti({ 
          particleCount: 5, 
          angle: 120, 
          spread: 55, 
          origin: { x: 1 }, 
          colors: ['#FF4D00', '#A3FF00', '#9D00FF'] 
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      }());
    });
  }
</script>
