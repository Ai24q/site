<!DOCTYPE html>
<html lang="uk">
<head>
  {{- partial "head.html" . -}}
</head>
<body class="font-body">
  <!-- Grain -->
  <div class="grain"></div>
  
  <!-- Cursor (desktop only) -->
  <div id="cursor"></div>
  
  <!-- Loader -->
  <div id="loader">
    <div class="flex gap-2 h-32 items-end">
      <div class="loader-bar"></div>
      <div class="loader-bar"></div>
      <div class="loader-bar"></div>
      <div class="loader-bar"></div>
      <div class="loader-bar"></div>
    </div>
    <h1 class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-neo-bg font-display font-bold text-6xl mix-blend-exclusion">ЗАВАНТАЖЕННЯ</h1>
  </div>
  
  <!-- Navigation -->
  {{- partial "nav.html" . -}}
  
  <!-- Main Content -->
  <main id="smooth-wrapper">
    <div id="smooth-content">
      {{- block "main" . }}{{- end }}
    </div>
  </main>
  
  <!-- Footer -->
  {{- partial "footer.html" . -}}
  
  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/lenis@1.0.29/dist/lenis.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  
  <script>
    lucide.createIcons();
    
    // Mobile Menu
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('close-menu');
    
    if(menuBtn) menuBtn.addEventListener('click', () => mobileMenu.classList.add('open'));
    if(closeMenu) closeMenu.addEventListener('click', () => mobileMenu.classList.remove('open'));
    if(mobileMenu) mobileMenu.addEventListener('click', (e) => { 
      if (e.target.tagName === 'A') mobileMenu.classList.remove('open'); 
    });
    
    // Preloader
    const tlLoader = gsap.timeline();
    tlLoader.to(".loader-bar", { height: "100%", duration: 0.8, stagger: 0.1, ease: "power4.inOut" })
      .to("#loader h1", { opacity: 0, duration: 0.2 })
      .to("#loader", { y: "-100%", duration: 0.8, ease: "power4.inOut" }, "-=0.2")
      .from(".hero-text", { y: 200, opacity: 0, rotate: 5, stagger: 0.1, duration: 1, ease: "power3.out" }, "-=0.5");
    
    // Lenis Smooth Scroll
    const lenis = new Lenis({ 
      duration: 1.2, 
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), 
      smooth: true, 
      touchMultiplier: 2 
    });
    
    function raf(time) { 
      lenis.raf(time); 
      requestAnimationFrame(raf); 
    }
    requestAnimationFrame(raf);
    
    // GSAP Animations
    gsap.registerPlugin(ScrollTrigger);
    
    gsap.to(".float-anim", { 
      y: -100, 
      scrollTrigger: { 
        trigger: "body", 
        start: "top top", 
        end: "bottom top", 
        scrub: 1 
      } 
    });
    
    gsap.to(".float-anim-reverse", { 
      y: 150, 
      rotate: 45, 
      scrollTrigger: { 
        trigger: "body", 
        start: "top top", 
        end: "bottom top", 
        scrub: 1.5 
      } 
    });
    
    document.querySelectorAll(".manifesto-text").forEach(text => {
      gsap.to(text, { 
        opacity: 1, 
        scrollTrigger: { 
          trigger: text, 
          start: "top 80%", 
          end: "top 40%", 
          scrub: true 
        } 
      });
    });
    
    document.querySelectorAll('.stats-card').forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        gsap.to(card, { 
          x: (x - rect.width / 2) / 5, 
          y: (y - rect.height / 2) / 5, 
          duration: 0.3, 
          ease: "power2.out" 
        });
      });
      card.addEventListener('mouseleave', () => {
        gsap.to(card, { 
          x: 0, 
          y: 0, 
          duration: 0.5, 
          ease: "elastic.out(1, 0.5)" 
        });
      });
    });
    
    gsap.from(".service-card", { 
      y: 100, 
      opacity: 0, 
      rotate: 5, 
      stagger: 0.1, 
      duration: 0.8, 
      ease: "back.out(1.7)", 
      scrollTrigger: { 
        trigger: ".service-card", 
        start: "top 85%" 
      } 
    });
    
    gsap.from("#process > div > div", { 
      y: 100, 
      opacity: 0, 
      stagger: 0.1, 
      duration: 0.8, 
      ease: "back.out(1.7)", 
      scrollTrigger: { 
        trigger: "#process", 
        start: "top 85%" 
      } 
    });
    
    gsap.from(".faq-item", { 
      y: 50, 
      opacity: 0, 
      stagger: 0.15, 
      duration: 0.6, 
      ease: "power2.out", 
      scrollTrigger: { 
        trigger: "#faq", 
        start: "top 80%" 
      } 
    });
    
    // Custom Cursor (desktop only)
    if (window.innerWidth > 768 && window.matchMedia('(pointer: fine)').matches) {
      const cursor = document.getElementById('cursor');
      const links = document.querySelectorAll('a, button, .service-card, summary');
      
      document.addEventListener('mousemove', (e) => {
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
      });
      
      links.forEach(link => {
        link.addEventListener('mouseenter', () => {
          cursor.style.width = '60px';
          cursor.style.height = '60px';
          cursor.style.backgroundColor = '#A3FF00';
          cursor.style.mixBlendMode = 'exclusion';
        });
        link.addEventListener('mouseleave', () => {
          cursor.style.width = '24px';
          cursor.style.height = '24px';
          cursor.style.backgroundColor = '#0f0f0f';
          cursor.style.mixBlendMode = 'difference';
        });
      });
    }
    
    // Danger Button
    const dangerBtn = document.getElementById('danger-btn');
    if(dangerBtn) {
      dangerBtn.addEventListener('click', () => {
        gsap.to("body", { x: -10, duration: 0.1, yoyo: true, repeat: 5 });
        
        const duration = 2000, end = Date.now() + duration;
        (function frame() {
          confetti({ 
            particleCount: 5, 
            angle: 60, 
            spread: 55, 
            origin: { x: 0 }, 
            colors: ['#FF4D00', '#A3FF00', '#9D00FF'] 
          });
          confetti({ 
            particleCount: 5, 
            angle: 120, 
            spread: 55, 
            origin: { x: 1 }, 
            colors: ['#FF4D00', '#A3FF00', '#9D00FF'] 
          });
          if (Date.now() < end) requestAnimationFrame(frame);
        }());
        
        const original = dangerBtn.innerHTML;
        dangerBtn.innerHTML = '<div class="relative border-4 border-black bg-neo-black px-8 py-6 md:px-12 md:py-8 font-heavy text-3xl md:text-5xl lg:text-6xl text-white flex items-center gap-3 md:gap-4">О НІ!</div>';
        setTimeout(() => { 
          dangerBtn.innerHTML = original; 
          lucide.createIcons(); 
        }, 3000);
      });
    }
  </script>
</body>
</html>
